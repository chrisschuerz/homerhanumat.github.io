<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: R | A Statistics Blog]]></title>
  <link href="http://homerhanumat.github.io/blog/categories/r/atom.xml" rel="self"/>
  <link href="http://homerhanumat.github.io/"/>
  <updated>2014-04-29T13:34:14-04:00</updated>
  <id>http://homerhanumat.github.io/</id>
  <author>
    <name><![CDATA[Homer White]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Five Reasons to Teach Elementary Statistics With R: #2]]></title>
    <link href="http://homerhanumat.github.io/blog/2014/04/08/reasons-to-teach-with-R-2/"/>
    <updated>2014-04-08T19:59:59-04:00</updated>
    <id>http://homerhanumat.github.io/blog/2014/04/08/reasons-to-teach-with-R-2</id>
    <content type="html"><![CDATA[<ul id="markdown-toc">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#reason-2--rstudios-manipulate">Reason #2:  RStudio’s <code>manipulate</code></a>    <ul>
      <li><a href="#do-it-yourself">Do It Yourself</a></li>
      <li><a href="#next-time">Next Time</a></li>
    </ul>
  </li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>This is is second in a projected five-part series of posts aimed at colleagues who teach elementary statistics.  If you teach with R but hesitate to spring such a powerful and complex tool on unsuspecting introductory students—many of whom whom will have had no prior experience with the command line, much less with coding—then I hope these posts will give you some encouragement.</p>

<p>The <a href="http://statistics.rainandrhino.org/blog/2014/04/05/tigerstatsintro/">first post</a> in this series introduced package <code>mosaic</code>, and promised to review a supplementary package that I and a colleague put together for our own students, but I’ve decided put that off a bit and focus instead on another powerful new tool for statistics instruction:  the well-known <a href="https://www.rstudio.com/">RStudio</a> Integrated Development Environment for R, and its <code>manipulate</code> package in particular.</p>

<h2 id="reason-2--rstudios-manipulate">Reason #2:  RStudio’s <code>manipulate</code></h2>

<p>You might think that an IDE is strictly for programmers.  The authors of <code>mosaic</code>, though, looked at RStudio and saw an environment ripe for customization to fit the elementary classroom.  RStudio offers many benefits in this regard, but for this post I’ll concentrate on just one:  its pre-installed package <code>manipulate</code>.</p>

<p>The RStudio developers may have written <code>manipulate</code> simply as a prototype for <a href="http://shiny.rstudio.com/">Shiny</a>, but it happens to be a fabulous tool for authoring instructional applets.  To be sure, there are many great instructional apps out on the web—visual stunners put together by authentic web developers—but the everyday statistics instructor may find that <code>manipulate</code> empowers her to quickly work up small instructional apps that address needs specific to her own students.</p>

<p>At my College, for example, we believe that simulation is important to understanding probability concepts, but we also find that our students don’t easily grasp the import of a simulation when the computers simply generates, say, 3000 re-samples and summarizes the results, <em>all in flash</em>.  We feel the need for plenty of “one at a time” simulation experiences that serve as transitions to the analysis of large-scale simulation results, and we don’t always find apps on the web that cater to our needs in just the way we would like.</p>

<p>Suppose you want students to understand coverage properties of confidence intervals—i.e., what we really mean when we say that we are “95%-confident” that the interval covers the population parameter–in a ground-up way.  Then you might do as my colleague Rebekah Robinson did, and write a manipulate app like <code>CIMean()</code>.</p>

<p>To get the app, install package <code>tigerstats</code> from CRAN, or for the very latest version try:</p>

<pre><code>require(devtools)
install_github(repo="homerhanumat/tigerstats")
</code></pre>

<p>Next, get into RStudio (if you are not there already), and run:</p>

<pre><code>require(tigerstats)
require(manipulate)
CIMean(~height,data=imagpop)
</code></pre>

<p>The app loads in the (roughly normally distributed) heights of an imaginary population of 10,000 people.  Sliders allow the user to select a sample size and a desired confidence level.  Click on one of the sliders and you’ll get just one sample from the population, with a histogram of the sample overlaying the density curve for the population, and a confidence interval displayed clearly along the horizontal axis.  The user can easily see whether the interval contains the population mean (marked by the red vertical line).  Output to the console also keeps the user apprised of what has just happened.  When the user has clicked enough to get the idea, he/she can ask for a lot of samples at once, verifying that when assumptions are met 95%-confidence intervals do indeed cover their target parameter about 95% of the time.</p>

<p>One advantage of <code>manipulate</code> apps over the visually spectacular ones you find on the web is that you can easily write them to accept arbitrary input.  <code>CIMean()</code>, for example, will deal with any numerical variable from any data frame on R’s search path,including the quite right-skewed variable <strong>income</strong> from<code>imagpop</code>:</p>

<pre><code>CIMean(~income,data=imagpop)
</code></pre>

<p>The user realizes quickly that the standard t-intervals applied to small samples from skewed populations do not possess the advertised coverage properties.</p>

<p>Once you get into the spirit of <code>manipulate</code> you may find yourself writing apps that work in a similar vein without requiring the elements of the package itself.  For example <code>ChisqSimSlow()</code>, which does not require <code>manipulate</code> (and in fact runs outside of RStudio) takes arbitrary data and applies a one-at-a-time re-sampling routine to slowly build up the Null Distribution of the chi-square statistic, in a situation where one is testing whether two factor variables are associated.</p>

<p>For example, suppose we are looking at survey in which a random sample of students were asked for their sex and for their seating preference in a classroom:</p>

<pre><code>SexSeat &lt;- xtabs(~sex+seat,data=m111survey)
SexSeat

##         seat
## sex      1_front 2_middle 3_back
##   female      19       16      5
##   male         8       16      7
</code></pre>

<p>Let’s check this out with some row percentages:</p>

<pre><code>rowPerc(SexSeat)

##        1_front 2_middle 3_back Total
## female   47.50    40.00  12.50   100
## male     25.81    51.61  22.58   100
</code></pre>

<p>Hmm, the women in the sample seem much more likely than the guys to prefer the Front!  Does this data provide convincing evidence for a relationship between <strong>sex</strong> and <strong>seat</strong> in the College population at large?  To investigate this, a student might try:</p>

<pre><code>ChisqSimSlow(~sex+seat,data=m111survey)
</code></pre>

<p>Keep asking for a re-sample, and after a while you get the sense that the observed value of the chi-square statistic is not an unusually large value, if <strong>sex</strong> and <strong>seat</strong> are, all along, unrelated in the population.</p>

<p>Once students understand the import of simulation they can employ it to advantage on a large scale.  In the <code>tigerstats</code> version of the <code>chisq.test()</code>, the student might ask for:</p>

<pre><code>set.seed(2014)
chisqtestGC(~sex+seat,data=m111survey,
      simulate.p.value="random",
      B=3000,
      graph=TRUE)

## Pearson's chi-squared test with simulated p-value, random effects
## 	 (based on 3000 resamples)
## 
## Observed Counts:
##         seat
## sex      1_front 2_middle 3_back
##   female      19       16      5
##   male         8       16      7
## 
## Counts Expected by Null:
##         seat
## sex      1_front 2_middle 3_back
##   female   15.21    18.03   6.76
##   male     11.79    13.97   5.24
## 
## Contributions to the chi-square statistic:
##         seat
## sex      1_front 2_middle 3_back
##   female    0.94     0.23   0.46
##   male      1.22     0.29   0.59
## 
## 
## Chi-Square Statistic = 3.734 
## Degrees of Freedom of the table = 2 
## P-Value = 0.1727
</code></pre>

<p><img src="/images/figure/reasonsteachr2.png" alt="plot of chunk reasonsteachr2" /> </p>

<h3 id="do-it-yourself">Do It Yourself</h3>

<p>I do not discuss the above apps with the expectation that colleagues at other institution will adopt them.  On the contrary, my point is merely that the folks at RStudio have provided R-users with a tool that enables ordinary instructors like us to write our own apps.  If you like a particular app, them check out the source code (<code>tigerstats</code>, for example is <a href="http:github.com/homerhanumat/tigerstats">on GitHub</a>), clean it up a bit maybe, and use it as a basis for an app tailored to your particular tastes and the needs of your particular students.</p>

<p>Better yet, persuade an upper-level student to write the app for you as a programming project:  <code>manipulate</code>’s greatest use may prove to be as a gateway-drug to coding!</p>

<h3 id="next-time">Next Time</h3>

<p>In the next post, maybe we’ll have a look at what R Studio’s <code>shiny</code> can do for an elementary class.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Five Reasons to Teach Elementary Statistics With R: #1]]></title>
    <link href="http://homerhanumat.github.io/blog/2014/04/05/tigerstatsintro/"/>
    <updated>2014-04-05T19:30:00-04:00</updated>
    <id>http://homerhanumat.github.io/blog/2014/04/05/tigerstatsintro</id>
    <content type="html"><![CDATA[<ul id="markdown-toc">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#reason-1--package-mosaic">Reason #1:  Package <code>mosaic</code></a>    <ul>
      <li><a href="#keeping-simple-things-simple">Keeping Simple Things Simple</a></li>
      <li><a href="#flow-control-for-the-masses">Flow-Control for the Masses</a></li>
      <li><a href="#there-is-much-more">There is Much More</a></li>
    </ul>
  </li>
  <li><a href="#references">References</a></li>
</ul>

<h2 id="introduction">Introduction</h2>

<p>This is is first in a projected five-part series of posts aimed at colleagues who teach elementary statistics.</p>

<p>I can’t remember exactly how I first made acquaintance with R, but it’s been an important part of my teaching/consulting life since at least 2007, when I used it for the first time in an upper-level undergraduate statistics class.  As of last Fall all of our statistics classes—even the elementary ones—are based on R.  We may never return to a ground-up GUI platform.  If you teach with R but hesitate to spring such a powerful and complex tool on unsuspecting introductory students—many of whom whom will have had no prior experience with the command line, much less with coding—then I hope these posts will give you some encouragement.</p>

<h2 id="reason-1--package-mosaic">Reason #1:  Package <code>mosaic</code></h2>

<p>This package is a product of the NSF-funded <a href="http://mosaic-web.org/">Project Mosaic</a>, led by Nick Horton, Daniel Kaplan and Randall Pruim.  It’s on CRAN, but you might want to keep up with the very latest releases on Github:</p>

<pre><code>require(devtools)
install_github(repo="rpruim/mosaic")
</code></pre>

<p><code>mosaic</code> aims to flatten the learning curve for elementary students by gentling down the coding aspects of the R experience.  With <code>mosaic</code>:</p>

<ul>
  <li>students need to know relatively few R-functions in order to thrive in the introductory course;</li>
  <li>many of the these functions are “wrappers” for standard R-functions, and provide a fairly uniform interface for user input;</li>
  <li>the package provides tools that mostly obviate the need for students to deal with R as a programming language:
    <ul>
      <li>the students don’t have to write their own functions;</li>
      <li>they don’t need to think much about the different types of R objects;</li>
      <li>they don’t even need to learn about flow-control structures.</li>
    </ul>
  </li>
</ul>

<h3 id="keeping-simple-things-simple">Keeping Simple Things Simple</h3>

<p>R can make the easy stuff surprisingly tricky for beginners:  suppose for example, that you want numerical summaries of a particular numerical variable, broken down by the values of some factor variable.  Standard procedure in R would be to write your own anonymous function as an argument for <code>aggregate()</code>, thus:</p>

<pre><code>aggregate(mpg~cyl,data=mtcars,
    FUN=function(x) c(mean=mean(x),sd=sd(x)))

##   cyl mpg.mean mpg.sd
## 1   4   26.664  4.510
## 2   6   19.743  1.454
## 3   8   15.100  2.560
</code></pre>

<p><code>mosaic</code> skirts the problem by providing wrapper functions for aggregation:</p>

<pre><code>require(mosaic)

 

mean(mpg~cyl,data=mtcars)

##     4     6     8 
## 26.66 19.74 15.10

sd(mpg~cyl,data=mtcars)

##     4     6     8 
## 4.510 1.454 2.560
</code></pre>

<p>One can attain even more simplicity, at only a small cost in flexibility, by sticking to <code>mosaic</code>’s <code>favstats()</code> as a one-stop shop:</p>

<pre><code>favstats(mpg~cyl,data= mtcars)

##   .group  min    Q1 median    Q3  max  mean    sd  n missing
## 1      4 21.4 22.80   26.0 30.40 33.9 26.66 4.510 11       0
## 2      6 17.8 18.65   19.7 21.00 21.4 19.74 1.454  7       0
## 3      8 10.4 14.40   15.2 16.25 19.2 15.10 2.560 14       0
</code></pre>

<h3 id="flow-control-for-the-masses">Flow-Control for the Masses</h3>

<p><code>mosaic</code> includes powerful wrapper functions that permit extensive work with re-sampling and simulation, without the need to learn flow-control.  Here follows a <code>mosaic</code>-style implementation of a permutation test.</p>

<p>Consider the data frame <code>Pseudoscorpions</code> from the <code>abd</code> package:</p>

<pre><code>require(abd)
data(Pseudoscorpions)
</code></pre>

<p><code>Pseudoscorpions</code> contains the results of an experiment on 36 female Pseudoscorpions:  each one was either mated twice with a single male (<code>SM</code>) or was mated with two males, one time each (<code>DM</code>), receiving about the same total amount of sperm under either treatment.  The idea was to see whether an increase in genetic diversity of sperm sources increases the number of successful broods a female produces during her lifetime.</p>

<p>Here are some descriptive results:</p>

<pre><code>favstats(successful.broods~treatment,
    data=Pseudoscorpions)[c(".group","mean","sd")]

##   .group  mean    sd
## 1     DM 3.625 1.962
## 2     SM 2.200 1.609
</code></pre>

<p>For the permutation test, we first compute and store the observed difference between the sample means:</p>

<pre><code>obsDiff &lt;- compareMean(successful.broods~treatment,
    data=Pseudoscorpions)
obsDiff

## [1] -1.425
</code></pre>

<p>Next, we create an empirical Null distribution with <code>shuffle()</code> (the random permutation function) and <code>do()</code> (a for-loop wrapper):</p>

<pre><code>set.seed(12345)
nullDist &lt;- do(2500)*(
  compareMean(successful.broods~shuffle(treatment),
      data=Pseudoscorpions))
</code></pre>

<p>Finally, we call <code>statTally()</code> for numerical and graphical analysis of the results:</p>

<pre><code>statTally(obsDiff,nullDist)

## Null distribution appears to be asymmetric. (p = 1.07e-05)
## 
## Test statistic applied to sample data =  -1.425
## 
## Quantiles of test statistic applied to random data:

##    50%    90%    95%    99% 
## 0.0375 0.8250 1.0500 1.3875

## 
## Of the random samples
## 
## 	13 ( 0.52 % ) had test stats = -1.425
## 
## 	23 ( 0.92 % ) had test stats &lt; -1.425
</code></pre>

<p><img src="/images/figure/reason1hist.png" alt="plot of chunk reason1hist" /> </p>

<p>We seem to have fairly strong evidence ($P \approx 1.7\%$) that mating with more males increases the number of successful broods.</p>

<h3 id="there-is-much-more">There is Much More</h3>

<p>I have only scratched the surface of the <code>mosaic</code> package, which is rich enough to support statistics instruction in both elementary and advanced courses.  The <code>mosaic</code> authors provide extensive instructor resources in the package vignettes, and frequently offer workshops and short-courses, especially through events sponsored by the <a href="https://www.causeweb.org/">Consortium for the Advancement of Undergraduate Statistics Education</a>.</p>

<p>Next week I’ll introduce a supplementary package that is intended for students who might require even more simplicity, and that aligns their R experience with a particular set of teaching objectives.</p>

<h2 id="references">References</h2>

<p>The Pseudoscorpion experiment is discussed in Whitlock and Schluter’s <em>The Analysis of Biological Data</em> (Roberts and Company Publishers; First Edition, 1st Edition July 2008).</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Pander/Pandoc for Pretty Conversion on the R Studio Server]]></title>
    <link href="http://homerhanumat.github.io/blog/2014/02/01/pander-for-pretty-conversion-on-the-r-studio-server/"/>
    <updated>2014-02-01T11:42:14-05:00</updated>
    <id>http://homerhanumat.github.io/blog/2014/02/01/pander-for-pretty-conversion-on-the-r-studio-server</id>
    <content type="html"><![CDATA[<p>Eventually we get around to teaching our students to turn in Homework assignments as R Markdown documents, and towards the end of the semester many of them will do a data analysis project, complete with a report generated as an HTML file.</p>

<p>But frankly the HTML output is a bit ugly.  What if students want something that looks a bit better?  What if they use R for data analysis in another class, and the instructor wants the report in some other format—a .docx, for instance?</p>

<p>Our solution, for now, involves <a href="http://johnmacfarlane.net/pandoc/">Pandoc</a>, an excellent universal document converter written by John MacFarlane.  The R package <code>pander</code> facilitates the use of Pandoc for conversion of documents that began as R Markdown, so you just need to ask your sysadmin to install Pandoc and <code>pander</code> on the server.  <code>pander</code> calls Pandoc, which will in turn convert a Markdown document into a variety of formats:  pdf, docx, odt, etc., as per your request.</p>

<p>For pdf output, Pandoc first turns the converts the Markdown into $\LaTeX$, so you will need to make sure that $\LaTeX$ is installed on the server as well (some minimal version probably comes with the distribution).  The engine default engine for conversion is <code>pdflatex</code>, followed by <code>lualatex</code> and <code>xelatex</code>, so you need to make sure that one of these is installed.  [<code>xelatex</code> came along with our CentOS R Studio server, but had to be configured.]</p>

<p>Students would use Pandoc through the <code>Pandoc.convert()</code> function from the <code>pander</code> package.  First, one knits the r Markdown document, simply in order to produce the Markdown document along the way.  Then set the working to directory to the directory containing the file you wish to convert, and run something like:</p>

<p><code>
require(pander)
Pandoc.convert(f="MyReport.md", format="pdf", options="-S")
</code></p>

<p>R complains bitterly in the console—apparently it attempts to open a preview window but cannot—but produces the desired file in the same directory as the Markdown file.</p>

<p>We find that pdf and docx format both look rather nice.  The pdf centers plots, too (this is popular with students).  Sadly, the code chunks do lose their background color under Pandoc’s default highlighting style of “pygments”.  If you try for some other style, e.g.,</p>

<p><code>
Pandoc.convert(f="MyReport.md", format="pdf", 
  options="-S --highlight-style="tango")
</code>
then in some installations of $\LaTeX$, including the one on our server, there will be an error.  We have not yet decided whether to bug the sysadmin to install a fuller version of $\LaTeX$ in order to get overcome this difficulty.</p>

]]></content>
  </entry>
  
</feed>
